{% extends 'Admin/base.html.twig' %}

{% block title %}Forms | {{ formConfig.title }} | Update{% endblock %}

{% block body %}
    <h2 class="border-bottom">
        {% block header %}Edit Form{% endblock %}
    </h2>
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#tab_1" role="tab" aria-controls="tab_1"
               aria-selected="true">Data</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="builder-tab-link" data-toggle="tab" href="#tab_2" role="tab" aria-controls="tab_2"
               aria-selected="false">Builder</a>
        </li>

    </ul>
    {{ form_start(form, {'attr': {'class': 'form-horizontal', 'id': 'config-form'}}) }}
    <div class="tab-content">
        <div class="tab-pane fade show active" id="tab_1" role="tabpanel" aria-labelledby="tab_1">
            <div class="form-group">
                {{ form_label(form.title) }}
                {{ form_widget(form.title, {'attr': {'class': 'form-control', 'placeholder': 'Title'}}) }}
            </div>
            <div class="form-group">
                {{ form_label(form.description) }}
                {{ form_widget(form.description, {'attr': {'class': 'form-control', 'placeholder': 'Description'}}) }}
            </div>
            {{ form_widget(form.config, {'attr': {'class': 'form-config-holder'}}) }}
        </div>
        <div class="tab-pane fade" id="tab_2" role="tabpanel" aria-labelledby="tab_2">
            <div id="formBuilder"></div>
        </div>
    </div>
    <div class="box-footer">
        <button type="submit" class="btn btn-primary">Save</button>
    </div>
    {{ form_end(form) }}
{% endblock %}

{% block javascript_inline %}
    {{ parent() }}

    <script type="text/javascript">
        $(document).ready(function () {
            var formBuilder = {
                formData: []
            };

            $('#builder-tab-link').one('shown.bs.tab', function () {
                formBuilder = $('#formBuilder').formBuilder({
                    disableFields: [
                        'autocomplete',
                        'button',
                        'file',
                        'header',
                        'hidden'
                    ],
                    controlOrder: [
                        'paragraph',
                        'text',
                        'textarea',
                        'number',
                        'checkbox',//TODO: add
                        'radio',//TODO: add
                        'checkbox-group',
                        'radio-group',
                        'date',
                        'select'
                    ],
                    disabledAttrs: [
                        'access',
                        'className',
                        'inline',
                        'name',
                        'other',
                        'rows',
                        'step',
                        'style',
                        'subtype',
                        'toggle'
                    ],
                    disabledActionButtons: ['data', 'save'],
                    formData: {{ formConfig.config|json_encode|raw }}
                });
            });

            $("#config-form").submit(function () {
                $(".form-config-holder").val(formBuilder.formData);
            })
        });
    </script>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script src="{{ asset('js/formBuilder/form-builder.min.js') }}"></script>
    <script src="{{ asset('js/jquery-ui-sortable/jquery-ui.min.js') }}"></script>
{% endblock %}
